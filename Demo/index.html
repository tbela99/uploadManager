<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>File Upload</title>
<style type="text/css">
#upload {

	border: 1px solid #ccc;
	max-width: 300px;
	min-height: 100px;
}
</style>
<script type="text/javascript" src="../mootools-core.js"></script>
<script type="text/javascript" src="../number.js"></script>
<script type="text/javascript" src="../Source/progressbar.js"></script>
<script type="text/javascript" src="../Source/upload.js"></script>
<script type="text/javascript">

window.addEvent('domready', function() {

	var options = {
		
			container: 'upload',
			base: '../php/upload.php',
			name: 'files[]',
			multiple: true, //enable multiple selection in file dialog
			progressbar: {

				width: 140, //fix the progressbar width
				color: '#000', 
				fillColor: '#fff',
				text: 'Pending...',
				onChange: function (value, progressbar) {
				
					//console.log(arguments)
					progressbar.setText('completed: ' + (100 * value).format() + '%')
				}
			},
			onAbort: function (object) {
			
				alert(object.message)
			},
			onCancel: function () {
			
				//upload size
				$('infos').set('html', uploadManager.getSize('upload').toFileSize());
			},
			onSuccess: function (infos) {
							
				//upload size
				$('infos').set('html', uploadManager.getSize('upload').toFileSize());
				//download link
				new Element('span', {html: '<a href="../php/upload.php?' + infos.path + '&dl=1&filename=' + infos.file + '">download</a> -&nbsp;'}).inject($(infos.transfer).getElement('a'), 'before')
			},
			onAllComplete: function (container) {
			
				alert('all transfers completed for "' + container + '"');
			}
		},
		fn = function () { uploadManager.enqueue = this.checked };
	
	uploadManager.enqueue = $('queue').addEvents({click: fn, change: fn}).checked;
	
	//enable file drag drop
	uploadManager.attachDragEvents('upload', options);
	
	document.getElement('a').addEvent('click', function(e) {
	
		e.stop();
		uploadManager.upload(options)
	})
})
</script>
</head>

<body><form action="" method="get"><a href="#">Upload a file</a> [upload size: <span id="infos">0</span>]<br/><input type="checkbox" id="queue"/> <label for="queue">Upload queue</label>
<div id="upload"></div></form>
</body>
</html>
